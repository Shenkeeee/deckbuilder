<div id="deck-container">
  <div id="search-filter-container">
    <mat-form-field>
      <mat-label for="search-field">Kártyanév:</mat-label>
      <input
        type="text"
        matInput
        id="search-field"
        [(ngModel)]="inputValue"
        (input)="updateAvailableCards()"
        placeholder="Doppelganger"
      />
    </mat-form-field>
    <button
      mat-flat-button
      color="primary"
      id="filter-button"
      class="ml-3"
      (click)="toggleFilters()"
    >
      <mat-icon>filter_list</mat-icon>
    </button>
  </div>

  <div>
    <!-- Filters -->
    <div class="filters-container" [class]="filtersContainerClass">
      <!-- Típus -->
      <h4>Típus</h4>
      <mat-chip-listbox multiple>
        <mat-chip-option (click)="onTypeChanges('vezeto')"
          >Vezető</mat-chip-option
        >
        <mat-chip-option (click)="onTypeChanges('karakter')"
          >Karakter</mat-chip-option
        >
        <mat-chip-option (click)="onTypeChanges('varazslat')"
          >Varázslat</mat-chip-option
        >
        <mat-chip-option (click)="onTypeChanges('aura')">Aura</mat-chip-option>
        <mat-chip-option (click)="onTypeChanges('zona')">Zóna</mat-chip-option>
        <mat-chip-option (click)="onTypeChanges('spirit')"
          >Spirit</mat-chip-option
        >
        <mat-chip-option (click)="onTypeChanges('portal csapda')"
          >Portál Csapda</mat-chip-option
        >
        <mat-chip-option (click)="onTypeChanges('szintlepes')"
          >Szintlépés</mat-chip-option
        >
      </mat-chip-listbox>

      <!-- Altípus -->
      <h4>Alkategória</h4>
      <mat-chip-listbox multiple>
        <mat-chip-option (click)="onSubTypeChanges('-')">Nincs</mat-chip-option>
        <mat-chip-option (click)="onSubTypeChanges('calm')"
          >Calm</mat-chip-option
        >
        <mat-chip-option (click)="onSubTypeChanges('silent')"
          >Silent</mat-chip-option
        >
        <mat-chip-option (click)="onSubTypeChanges('horror')"
          >Horror</mat-chip-option
        >
        <mat-chip-option (click)="onSubTypeChanges('scream')"
          >Scream</mat-chip-option
        >
        <mat-chip-option (click)="onSubTypeChanges('sima')"
          >Sima</mat-chip-option
        >
        <mat-chip-option (click)="onSubTypeChanges('instant')"
          >Instant</mat-chip-option
        >
        <mat-chip-option (click)="onSubTypeChanges('break')"
          >Break</mat-chip-option
        >
        <mat-chip-option (click)="onSubTypeChanges('shard')"
          >Shard</mat-chip-option
        >
        <mat-chip-option (click)="onSubTypeChanges('veteran')"
          >Veterán</mat-chip-option
        >
        <mat-chip-option (click)="onSubTypeChanges('elit')"
          >Elit</mat-chip-option
        >
        <mat-chip-option (click)="onSubTypeChanges('soundwave')"
          >Soundwave</mat-chip-option
        >
      </mat-chip-listbox>

      <!-- Megjelenés -->
      <h4>Megjelenés</h4>
      <mat-chip-listbox multiple>
        <mat-chip-option (click)="onReleaseChanges('23')">2023</mat-chip-option>
        <mat-chip-option (click)="onReleaseChanges('24')">2024</mat-chip-option>
        <mat-chip-option (click)="onReleaseChanges('25')">2025</mat-chip-option>
      </mat-chip-listbox>

      <!-- Mana -->
      <div>
        <h4>Mana</h4>
      </div>
      <div id="mana-list-container">
        <mat-chip-listbox multiple>
          <mat-chip-option (click)="onManaCostChanges('0')">0</mat-chip-option>
          <mat-chip-option (click)="onManaCostChanges('1')">1</mat-chip-option>
          <mat-chip-option (click)="onManaCostChanges('2')">2</mat-chip-option>
          <mat-chip-option (click)="onManaCostChanges('3')">3</mat-chip-option>
          <mat-chip-option (click)="onManaCostChanges('4')">4</mat-chip-option>
          <mat-chip-option (click)="onManaCostChanges('5')">5</mat-chip-option>
          <mat-chip-option (click)="onManaCostChanges('6')">6</mat-chip-option>
          <mat-chip-option (click)="onManaCostChanges('7')">7+</mat-chip-option>
        </mat-chip-listbox>
      </div>

      <!-- Spirit -->
      <div>
        <h4>Spirit</h4>
        <mat-chip-listbox multiple>
          <mat-chip-option (click)="onSpiritChanges('1')">1</mat-chip-option>
          <mat-chip-option (click)="onSpiritChanges('2')">2</mat-chip-option>
          <mat-chip-option (click)="onSpiritChanges('3')">3</mat-chip-option>
        </mat-chip-listbox>
      </div>

      <!-- Dupla -->
      <div>
        <h4>Dupla</h4>
        <mat-chip-listbox multiple>
          <mat-chip-option (click)="onManaPlusChanges('2')"
            >Mana</mat-chip-option
          >
          <mat-chip-option (click)="onLaphuzasPlusChanges('2')"
            >Laphúzás</mat-chip-option
          >
        </mat-chip-listbox>
      </div>
      
      <!-- Nyeremény -->
      <div>
        <h4>Nyeremény</h4>
        <mat-chip-listbox multiple>
          <mat-chip-option (click)="onWinnableChanges('')">Sima</mat-chip-option>
          <mat-chip-option (click)="onWinnableChanges('1')">Nyeremény</mat-chip-option>
        </mat-chip-listbox>
      </div>
    </div>

    <!-- <div id="deck-name-container">
            <mat-form-field>
                <mat-label for="deck-name-field">Deck Név:</mat-label>
                <input matInput type="text" id="deck-name-field" placeholder="Deck 1">
            </mat-form-field>
        </div> -->

    <!-- <div id="copy-deck-container">
            <button mat-flat-button id="copy-deck-button" (click)="copyDeckCode()"><mat-icon>save</mat-icon></button>
        </div> -->

    <!-- Formátum -->
    <mat-form-field>
      <mat-label>Formátum</mat-label>
      <mat-select
        (selectionChange)="updateSelectionFormat()"
        [(ngModel)]="selectedFormat"
        [(value)]="selectedFormat"
      >
        <mat-option value="standard" default>Standard</mat-option>
        <mat-option value="rush">Rush</mat-option>
        <mat-option value="profi">Profi</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-label class="ml-8" title="Kilistázott kártyák száma">{{
      cardInstancesOBSVALCHILD
    }}</mat-label>

    <div class="flex items-center">
      <mat-slider
        min="250"
        max="450"
        step="10"
        (change)="updateCardWidth($event)"
      >
        <input matSliderThumb [(ngModel)]="defaultCardSize" #slider />
      </mat-slider>
      <mat-icon class="ml-3">zoom_in</mat-icon>
    </div>

    <div id="deck-info-container" class="mb-2">
      <div id="card-count" title="{{ formatAdditionalHint }}">
        {{ selectedCardsNum }}/{{ cardsNum }} + {{ selectedCardsAdditional }}/{{
          selectedFormatAdditionalLimit
        }}
        Kártya
      </div>
      <button
        mat-flat-button
        color="primary"
        id="copy-deck-button"
        class="ml-4"
        (click)="copyDeckCode()"
      >
        <mat-icon>save</mat-icon>
      </button>
      <button
        mat-flat-button
        color="accent"
        id="clear-deck-button"
        class="ml-4"
        name="clear-deck-button"
        (click)="clearDeck()"
      >
        <mat-icon>delete_forever</mat-icon>
      </button>
    </div>

    <!-- card list -->
    <div id="card-list-container">
      <div
        *ngIf="currentDeck.cards.length !== 0"
        cdkDropList
        (cdkDropListDropped)="onDrop($event)"
      >
        @for (card of currentDeck.cards; track card) {
        <div
          class="cardContainerInDeck my-2"
          cdkDrag
          (cdkDragStarted)="onDragStart()"
          (cdkDragEnded)="onDragEnd()"
        >
          <p class="flex justify-between w-11/12 items-center">
            <span class="cursor-default">
              <span [title]="card.card.CardType">
                <span *ngIf="card.card.CardType === 'Vezető'">
                  <mat-icon style="vertical-align: bottom"
                    >stars</mat-icon
                  >
                </span>
                <span *ngIf="card.card.CardType === 'Spirit'">
                  <mat-icon style="vertical-align: bottom"
                    >brightness_7  </mat-icon
                  >
                </span>
                <span *ngIf="card.card.CardType === 'Szintlépés'">
                  <mat-icon style="vertical-align: bottom"
                    >arrow_circle_up </mat-icon
                  >
                </span>
              </span>
              <span>
                {{ card.card.Name }}
                - {{ card.amount }}
              </span>
            </span>
            <!-- <button
              class="removeAllButton"
              mat-flat-button
              (click)="removeAllFromDeck(card.card)"
            >
          </button> -->
            <mat-icon
              (click)="removeAllFromDeck(card.card)"
              class="cursor-pointer"
              >delete</mat-icon
            >
          </p>

          <div class="relative w-full inline-block mt-2">
            <img
              class="mt-2"
              (mouseenter)="
                card.card.ImagePath && showHoveredCard(card.card.ImagePath);
                hovered = card.card.ImagePath ? card.card.ImagePath : null
              "
              (mouseout)="hideHoveredCard()"
              (click)="clickOnPicture(card.card.ImagePath)"
              [ngStyle]="{
                filter:
                  hovered === card.card.ImagePath
                    ? 'brightness(2.5)'
                    : 'brightness(1)',
                transition: 'filter 0.1s ease'
              }"
              [src]="
                card.card.ImagePath
                  ? 'assets/pics/' + card.card.ImagePath + '.webp'
                  : 'assets/pics/feherszint.png_resize.webp'
              "
              alt="{{ card.card.ImagePath }}"
            />
            <button
              id="cardAddModifier"
              class="modifier amountModifier right-32"
            >
              <mat-icon class="h-full" (click)="addToDeck(card.card)"
                >add</mat-icon
              >
            </button>
            <button
              id="cardRemoveModifier"
              class="modifier amountModifier right-20"
            >
              <mat-icon class="h-full" (click)="removeFromDeck(card.card)"
                >remove</mat-icon
              >
            </button>

            <div cdkDragHandle class="modifier dragModifier">
              <mat-icon class="h-full">drag_indicator</mat-icon>
            </div>
          </div>

          <!-- hover picture - hidden in css when dragging happens -->
          <div *ngIf="hoveredImagePath === card.card.ImagePath">
            <img
              [ngStyle]="{
                position: 'absolute',
                top: '140px',
                left: '330px',
                display: 'block'
              }"
              style="
                width: 460px;
                max-width: 460px;
                height: auto;
                display: none;
                z-index: 3;
                box-shadow: 0 0 8px 4px rgba(255, 255, 255, 0.3);
                border-radius: 25px;
              "
              [src]="'assets/pics/' + hoveredImagePath + '.webp'"
              alt="{{ hoveredImagePath }}"
            />
          </div>

          <!-- click picture - hidden in css when dragging happens -->
          <div
            *ngIf="clickedOnPicture && clickedImagePath === card.card.ImagePath"
            (click)="clickOnPicture()"
            class="block sm:hidden"
          >
            <img
              [ngStyle]="{
                position: 'fixed',
                top: '50%',
                left: '50%',
                transform: 'translate(-50%, -50%)',
                display: 'block'
              }"
              style="
                width: 92vw;
                max-width: 92vw;
                height: auto;
                display: none;
                z-index: 3;
                box-shadow: 0 0 8px 4px rgba(255, 255, 255, 0.3);
                border-radius: 25px;
              "
              [src]="'assets/pics/' + clickedImagePath + '.webp'"
              alt="{{ clickedImagePath }}"
            />
          </div>
        </div>
        }
      </div>
    </div>
  </div>
</div>
